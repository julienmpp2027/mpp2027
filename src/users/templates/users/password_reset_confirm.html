{% extends 'base.html' %}

{% block title %}Nouveau mot de passe - MPP 2027{% endblock title %}

{% block content %}

<div class="auth-layout">

    <h1 style="text-align: center; color: var(--couleur-secondaire); margin-bottom: 30px; font-weight: 800; text-transform: uppercase;">
        Sécuriser mon compte
    </h1>

    <div class="dashboard-card" style="padding: 40px;">

        {% if validlink %}

            <p style="color: #666; margin-bottom: 25px; text-align: center; line-height: 1.5;">
                Veuillez entrer votre nouveau mot de passe deux fois pour le confirmer.
            </p>

            <form method="POST">
                {% csrf_token %}

                {% if form.non_field_errors %}
                    <div class="alert alert-danger">
                        {% for error in form.non_field_errors %}
                            {{ error }}
                        {% endfor %}
                    </div>
                {% endif %}

                {% for field in form %}
                    <div class="form-group">
                        <label for="{{ field.id_for_label }}">{{ field.label }}</label>

                        {{ field }}

                        {% if field.errors %}
                            <div class="field-errors">
                                {% for error in field.errors %}
                                    <p style="margin: 5px 0 0 0;"><i class="fas fa-exclamation-circle"></i> {{ error }}</p>
                                {% endfor %}
                            </div>

                            {% if field.help_text %}
                                <div class="help-text" style="margin-top: 10px; font-size: 0.85em; color: #777;">
                                    {{ field.help_text|safe }}
                                </div>
                            {% endif %}
                        {% endif %}
                    </div>
                {% endfor %}

                <button type="submit" class="btn-action red" style="width: 100%; margin-top: 20px; border: none; cursor: pointer; font-size: 1.1em; padding: 15px;">
                    Changer mon mot de passe
                </button>

            </form>

        {% else %}

            <div style="text-align: center;">
                <i class="fas fa-times-circle" style="font-size: 3em; color: var(--couleur-tertiaire); margin-bottom: 15px;"></i>
                <h3 style="color: #333; margin-top: 0;">Ce lien a expiré</h3>
                <p style="color: #666; margin-bottom: 20px;">
                    Ce lien de réinitialisation n'est plus valide (déjà utilisé ou trop vieux).
                </p>
                <a href="{% url 'users:password_reset' %}" style="color: var(--couleur-principale); text-decoration: underline; font-weight: bold;">
                    Refaire une demande
                </a>
            </div>

        {% endif %}

    </div>

</div>

{% endblock content %}